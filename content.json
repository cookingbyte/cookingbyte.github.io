{"posts":[{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","link":"/1985/10/26/hello-world/"},{"title":"åŸºç¡€é¡¹ç›®å¼€å‘","text":"å…»è€é¡¹ç›®ä¸€ã€åŸºç¡€æ•°æ®å¼€å‘å‰ç»çŸ¥è¯†ç‚¹ ä¸ºä»€ä¹ˆè¦åŒºåˆ† DTO å’Œ VO å¯¹è±¡ï¼Ÿ å› ä¸ºæœ‰äº›æƒ…å†µä¸æƒ³ä¼ å®Œæ•´çš„æ•°æ®è¿›å»ï¼Œvoç›¸å½“äºèƒ½è¿‡æ»¤ä¸€éï¼Œåªå‘é€å¿…è¦çš„æ•°æ®ã€‚ æŠ¤ç†æ¥å£åˆ†é¡µæŸ¥è¯¢æ•°æ®åˆ›å»ºä¸€ä¸ªdtoå¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849/** * æŠ¤ç†é¡¹ç›®æ•°æ®ä¼ è¾“å¯¹è±¡ */@Datapublic class NursingProjectDto extends BaseDto { /** * åç§° */ @ApiModelProperty(value = &quot;åç§°&quot;) private String name; /** * æ’åºå· */ @ApiModelProperty(value = &quot;æ’åºå·&quot;) private Integer orderNo; /** * å•ä½ */ @ApiModelProperty(value = &quot;å•ä½&quot;) private String unit; /** * ä»·æ ¼ */ @ApiModelProperty(value = &quot;ä»·æ ¼&quot;) private BigDecimal price; /** * å›¾ç‰‡ */ @ApiModelProperty(value = &quot;å›¾ç‰‡&quot;) private String image; /** * æŠ¤ç†è¦æ±‚ */ @ApiModelProperty(value = &quot;æŠ¤ç†è¦æ±‚&quot;) private String nursingRequirement; /** * çŠ¶æ€ï¼ˆ0ï¼šç¦ç”¨ï¼Œ1ï¼šå¯ç”¨ï¼‰ */ @ApiModelProperty(value = &quot;çŠ¶æ€ï¼ˆ0ï¼šç¦ç”¨ï¼Œ1ï¼šå¯ç”¨ï¼‰&quot;) private Integer status;} Controll12345678910111213141516171819202122232425/** * @author geb * @create 2025-01-27-10:59 AM */@RestController@RequestMapping(&quot;/nursing_project&quot;)public class NursingProjectController extends BaseController{ @Autowired private NursingProjectService nursingProjectService; @GetMapping public ResponseResult getByPage(@RequestParam(value = &quot;name&quot;, required = false) String name, @RequestParam(value = &quot;pageNum&quot;,defaultValue = &quot;1&quot;) Integer pageNum, @RequestParam(value = &quot;pageSize&quot;,defaultValue = &quot;10&quot;) Integer pageSize, @RequestParam(value = &quot;status&quot;,required = false) Integer status) { PageResponse&lt;NursingProjectVo&gt; page = nursingProjectService.getPage(name, pageNum, pageSize, status); return success(page); }} Service123456789/** * @author geb * @create 2025-02-05-1:34 PM */public interface NursingProjectService { public PageResponse&lt;NursingProjectVo&gt; getPage(String name,Integer pageNum,Integer pageSize,Integer state);} ServiceImpl1234567891011121314151617181920212223/** * @author geb * @create 2025-02-05-1:40 PM */@Servicepublic class NursingProjectServiceImpl implements NursingProjectService { @Autowired private NursingProjectMapper nursingProjectMapper; @Override public PageResponse&lt;NursingProjectVo&gt; getPage(String name, Integer pageNum, Integer pageSize, Integer status) { //åˆ†é¡µ PageHelper.startPage(pageNum,pageSize); Page&lt;NursingProjectVo&gt; projectVoPage = nursingProjectMapper.getByPage(name, pageNum, pageSize, status); return PageResponse.of(projectVoPage,NursingProjectVo.class); }} Mapper123456789@Mapperpublic interface NursingProjectMapper { public Page&lt;NursingProjectVo&gt; getByPage( String name, Integer pageNum, Integer pageSize, Integer status );} 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;&lt;mapper namespace=&quot;com.zzyl.mapper.NursingProjectMapper&quot;&gt; &lt;resultMap id=&quot;nursingProjectResultMap&quot; type=&quot;com.zzyl.vo.NursingProjectVo&quot;&gt; &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt; &lt;result column=&quot;name&quot; property=&quot;name&quot;/&gt; &lt;result column=&quot;order_no&quot; property=&quot;orderNo&quot;/&gt; &lt;result column=&quot;unit&quot; property=&quot;unit&quot;/&gt; &lt;result column=&quot;price&quot; property=&quot;price&quot;/&gt; &lt;result column=&quot;image&quot; property=&quot;image&quot;/&gt; &lt;result column=&quot;nursing_requirement&quot; property=&quot;nursingRequirement&quot;/&gt; &lt;result column=&quot;status&quot; property=&quot;status&quot;/&gt; &lt;result column=&quot;create_by&quot; property=&quot;createBy&quot;/&gt; &lt;result column=&quot;update_by&quot; property=&quot;updateBy&quot;/&gt; &lt;result column=&quot;remark&quot; property=&quot;remark&quot;/&gt; &lt;result column=&quot;create_time&quot; property=&quot;createTime&quot;/&gt; &lt;result column=&quot;update_time&quot; property=&quot;updateTime&quot;/&gt; &lt;result column=&quot;creator&quot; property=&quot;creator&quot;/&gt; &lt;/resultMap&gt; &lt;select id=&quot;getByPage&quot; resultMap=&quot;nursingProjectResultMap&quot;&gt; select np.id, np.name, np.order_no, np.unit, np.price, np.image, np.nursing_requirement, np.status, np.create_by, np.update_by, np.remark, np.create_time, np.update_time, su.real_name from nursing_project np left join sys_user su on np.create_by=su.id &lt;where&gt; &lt;if test=&quot;name != null and name != ''&quot;&gt; and name like concat('%',#{name},'%') &lt;/if&gt; &lt;if test=&quot;status != null&quot;&gt; and status = #{status} &lt;/if&gt; &lt;/where&gt; &lt;/select&gt;&lt;/mapper&gt; ![image-20250206114812693](/Users/gebin/Library/Application Support/typora-user-images/image-20250206114812693.png) æ–°å¢Controll123456789101112/** * æ·»åŠ æŠ¤ç†é¡¹ç›® * @param nursingProjectDto * @return */ @PostMapping public ResponseResult add(@RequestBody NursingProjectDto nursingProjectDto){ nursingProjectService.add(nursingProjectDto); return success();} Service12345/** * æ·»åŠ æŠ¤ç†é¡¹ç›® * @param nursingProjectDto */ void add(NursingProjectDto nursingProjectDto); ServiceImpl12345678910111213/** * æ·»åŠ æŠ¤ç†é¡¹ç›® * * @param nursingProjectDto */ @Override public void add(NursingProjectDto nursingProjectDto) { //å¯¹è±¡çš„è½¬æ¢ æŠŠå½“å‰nursingProjectDto é‡Œé¢çš„æ‰€æœ‰å±æ€§éƒ½æ‹·è´åˆ°NursingProject ä¸­ï¼Œå› ä¸ºnursingProjectDto ä¸­çš„å±æ€§ä¸å…¨ NursingProject nursingProject = BeanUtil.copyProperties(nursingProjectDto, NursingProject.class); //è°ƒç”¨mapper nursingProjectMapper.insert(nursingProject); } Mapper1void insert(NursingProject nursingProject); 123456&lt;insert id=&quot;insert&quot;&gt; insert into nursing_project (name, order_no, unit, price, image, nursing_requirement, status, create_by, update_by, remark, create_time, update_time) values (#{name}, #{orderNo}, #{unit}, #{price}, #{image}, #{nursingRequirement}, #{status}, #{createBy}, #{updateBy}, #{remark}, #{createTime}, #{updateTime})&lt;/insert&gt; ![image-20250206170214310](/Users/gebin/Library/Application Support/typora-user-images/image-20250206170214310.png) ç¼–è¾‘å›æ˜¾æ•°æ®â€“ æ ¹æ®IDæŸ¥è¯¢æ•°æ®Controll1234567@GetMapping(&quot;/{id}&quot;) public ResponseResult getById(@PathVariable(&quot;id&quot;) Long id){ NursingProjectVo nursingProjectVo = nursingProjectService.getById(id); return success(nursingProjectVo);} Service123456 /** * æ ¹æ®id æŸ¥è¯¢æŠ¤ç†é¡¹ç›® * @param id * @return */NursingProjectVo getById(Long id); ServiceImpl12345678910/** * æ ¹æ®id æŸ¥è¯¢æŠ¤ç†é¡¹ç›® * * @param id * @return */ @Overridepublic NursingProjectVo getById(Long id) { return nursingProjectMapper.getById(id);} Mapper1NursingProjectVo getById(Long id); 12345&lt;select id=&quot;getById&quot; resultMap=&quot;nursingProjectResultMap&quot;&gt; select * from nursing_project where id = #{id}&lt;/select&gt; ![image-20250206175745552](/Users/gebin/Library/Application Support/typora-user-images/image-20250206175745552.png) æ­¤æ—¶ï¼Œå›æ˜¾æ•°æ®æˆåŠŸ æ›´æ–°æ•°æ®Controll12345@PutMapping public ResponseResult update(@RequestBody NursingProjectDto nursingProjectDto){ nursingProjectService.update(nursingProjectDto); return success(); } Service12345/** * ä¿®æ”¹æŠ¤ç†é¡¹ç›® * @param nursingProjectDto */ void update(NursingProjectDto nursingProjectDto); ServiceImpl1234567891011/** * ä¿®æ”¹æŠ¤ç†é¡¹ç›® * * @param nursingProjectDto */ @Override public void update(NursingProjectDto nursingProjectDto) { NursingProject nursingProject = new NursingProject(); BeanUtils.copyProperties(nursingProjectDto, nursingProject); nursingProjectMapper.update(nursingProject); } Mapper1void update(NursingProject nursingProject); 1234567891011121314&lt;update id=&quot;update&quot;&gt; update nursing_project set name = #{name}, order_no = #{orderNo}, unit = #{unit}, price = #{price}, image = #{image}, nursing_requirement = #{nursingRequirement}, status = #{status}, update_by = #{updateBy}, remark = #{remark}, update_time = #{updateTime} where id = #{id} &lt;/update&gt; äºŒã€å¾®ä¿¡ç™»å½•Controll12345678910111213141516@RestController@RequestMapping(&quot;/customer/user&quot;)@Api(tags = &quot;å°ç¨‹åºç™»å½•&quot;)public class CustomerUserController extends BaseController { @Autowired private MemberService memberService; @PostMapping(&quot;/login&quot;) @ApiOperation(&quot;ç™»å½•&quot;) public ResponseResult&lt;LoginVo&gt; login(@RequestBody UserLoginRequestDto dto){ LoginVo loginVo = memberService.login(dto); return ResponseResult.success(loginVo); }} Service123456789101112/** * ç”¨æˆ·ç®¡ç† */public interface MemberService { /** * ç™»å½•æ–¹æ³• * @param dto * @return */ LoginVo login(UserLoginRequestDto dto);} ServiceImplè·å–æ‰‹æœºå·1234567891011121314151617181920212223242526272829303132333435363738394041/** * ç”¨æˆ·ç®¡ç† */@Slf4j@Servicepublic class MemberServiceImpl implements MemberService { @Autowired private WechatService wechatService; @Autowired private MemberMapper memberMapper; @Autowired private JwtTokenManagerProperties jwtTokenManagerProperties; static ArrayList DEFAULT_NICKNAME_PREFIX = Lists.newArrayList( &quot;ç”Ÿæ´»æ›´ç¾å¥½&quot;, &quot;å¤§æ¡”å¤§åˆ©&quot;, &quot;æ—¥å¯Œä¸€æ—¥&quot;, &quot;å¥½æŸ¿å¼€èŠ±&quot;, &quot;æŸ¿æŸ¿å¦‚æ„&quot;, &quot;ä¸€æ¤°æš´å¯Œ&quot;, &quot;å¤§æŸšæ‰€ä¸º&quot;, &quot;æ¨æ¢…åæ°”&quot;, &quot;å¤©ç”Ÿè”æ&quot; ); /** * ç™»å½•æ–¹æ³• * * @param dto * @return */ @Override public LoginVo login(UserLoginRequestDto dto) { //1. æ ¹æ®code è°ƒç”¨api è·å– openid ï¼Œç”±äºå¾ˆå¤šæƒ…å†µè¦è°ƒç”¨apiï¼Œæ‰€ä»¥ å°è£… å‡ºå»ï¼ï¼ï¼ String openId = wechatService.getOpenId(dto.getCode()); æ­¤æ—¶ï¼Œå› ä¸ºå…¶ä»–åŠŸèƒ½ä¼šè°ƒç”¨ æ ¹æ®code è°ƒç”¨api è·å– openid è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥å°è£…å‡ºå»ã€‚ 12345678910111213141516171819public interface WechatService { /** * è·å–openID * @param code å‰ç«¯ä¼ è¿‡æ¥çš„å‡­è¯ * @return */ public String getOpenId(String code); /** * è·å–æ‰‹æœºå· * @param phoneCode * @return */ public String getPhone(String phoneCode); } 12345678910111213141516171819202122232425262728293031@Service@Slf4jpublic class WechatServiceImpl implements WechatService { // ç™»å½• private static final String REQUEST_URL = &quot;https://api.weixin.qq.com/sns/jscode2session?grant_type=authorization_code&quot;; // è·å–token private static final String TOKEN_URL = &quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&quot;; // è·å–æ‰‹æœºå· private static final String PHONE_REQUEST_URL = &quot;https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=&quot;; @Value(&quot;${zzyl.wechat.appId}&quot;) private String appId; @Value(&quot;${zzyl.wechat.appSecret}&quot;) private String secret; /** * è·å–openID * * @param code * @return */ @Override public String getOpenId(String code) { //ä½¿ç”¨ç³Šæ¶‚å·¥å…· Map&lt;String,Object&gt; requestParamMap = getAppConfig();//å°è£…ç»“æŸ,è¿™ä¸ªå°è£…äº†å‰ä¸¤é¡¹ requestParamMap.put(&quot;js_code&quot;, code);//ç»§ç»­å°è£…è¿›å»code å°è£…ä¾ç…§ä¸‹é¢å›¾ç‰‡å†…å®¹æ¥è‡ªå®˜æ–¹æ–‡æ¡£ ![image-20250212144535240](/Users/gebin/Library/Application Support/typora-user-images/image-20250212144535240.png) 123456789101112/** * å°è£…å‚æ•° * @return */ private Map&lt;String, Object&gt; getAppConfig() { Map&lt;String,Object&gt; resultMap = new HashMap&lt;&gt;(); resultMap.put(&quot;appid&quot;,appId);//é…ç½®æ–‡ä»¶ä¸­æœ‰ resultMap.put(&quot;secret&quot;,secret); return resultMap; } åˆå› ä¸ºå®˜æ–¹è¿”å›å®ä¾‹æ˜¯ ![image-20250212144911268](/Users/gebin/Library/Application Support/typora-user-images/image-20250212144911268.png) https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/user-login/code2Session.html 12345678910111213141516171819String result = HttpUtil.get(REQUEST_URL, requestParamMap);//è¿™å°±æ˜¯å®˜æ–¹è¦æ±‚çš„æ ¼å¼ /* { result çš„æ ·å­å¦‚ä¸‹ -----------æˆ‘è¦æ‹¿åˆ°é‡Œé¢çš„openid &quot;openid&quot;:&quot;xxxxxx&quot;, &quot;session_key&quot;:&quot;xxxxx&quot;, &quot;unionid&quot;:&quot;xxxxx&quot;, &quot;errcode&quot;:0, &quot;errmsg&quot;:&quot;xxxxx&quot; }*/ //å­—ç¬¦ä¸²è½¬æˆ json JSONObject jsonObject = JSONUtil.parseObj(result);//JSONObject æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¢å¼ºçš„mapï¼Œæ‰€ä»¥å½“æˆmapç”¨ //åˆ¤æ–­æ¥å£æ˜¯å¦è¯·æ±‚æˆåŠŸ if (ObjectUtil.isNotEmpty(jsonObject.getInt(&quot;errcode&quot;))){ throw new BaseException(jsonObject.getStr(&quot;errmsg&quot;)); } return jsonObject.getStr(&quot;openid&quot;); } å±äº ä¸Šé¢çš„ getOpenId è¿™ä¸ªæ–¹æ³• è·å–openIdéœ€è¦çš„å‚æ•° ![image-20250212155044000](/Users/gebin/Library/Application Support/typora-user-images/image-20250212155044000.png) å®ƒéœ€è¦è°ƒç”¨çš„æ˜¯ä¸‹é¢è¿™å¼ å›¾çš„æ¥å£ ![image-20250212155616890](/Users/gebin/Library/Application Support/typora-user-images/image-20250212155616890.png) 12345678910111213141516171819/** * è·å–æ‰‹æœºå· * https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/user-info/phone-number/getPhoneNumber.html * @param phoneCode * @return */ @Override public String getPhone(String phoneCode) { //æ­¤å¤„è¦å°è£…ä¸€ä¸ªtokenæ–¹æ³• String token = getToken();//æ‹¿åˆ°äº†token String url = PHONE_REQUEST_URL + token;//ä½œä¸ºä¸€ä¸ªurl //æœ€åæŠŠcodeå°è£…è¿›å» Map&lt;String,Object&gt; param = new HashMap&lt;&gt;(); param.put(&quot;code&quot;,phoneCode);//å¦‚ä¸‹å›¾ï¼Œé™¤äº†æ‹¼æ¥ä¸€ä¸ªè¿˜éœ€è¦codeå‚æ•° //æ ¹æ®å¼€å‘æ–‡æ¡£è¿›è¡Œè°ƒç”¨ String result = HttpUtil.post(url, JSONUtil.toJsonStr(param)); ![image-20250212160748296](/Users/gebin/Library/Application Support/typora-user-images/image-20250212160748296.png) å› ä¸ºébodyå‚æ•°ï¼Œæ‰€ä»¥è¦æ‹¼æ¥ï¼ŒString url = PHONE_REQUEST_URL + token;//ä½œä¸ºä¸€ä¸ªurlè¿›è¡Œä¼ é€’ 123456789101112131415161718192021222324252627282930 //å­—ç¬¦ä¸²è½¬æˆ json JSONObject jsonObject = JSONUtil.parseObj(result);//JSONObject æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¢å¼ºçš„mapï¼Œæ‰€ä»¥å½“æˆmapç”¨ //åˆ¤æ–­æ¥å£æ˜¯å¦è¯·æ±‚æˆåŠŸ if (jsonObject.getInt(&quot;errcode&quot;) != 0){ //ä¸ç­‰äº0 ä»£è¡¨æˆåŠŸ throw new BaseException(jsonObject.getStr(&quot;errmsg&quot;)); } return jsonObject.getJSONObject(&quot;phone_info&quot;).getStr(&quot;phoneNumber&quot;); } public String getToken(){ Map&lt;String, Object&gt; map = getAppConfig();//ä¹‹å‰å°è£…çš„ String result = HttpUtil.get(TOKEN_URL, map);//ä½¿ç”¨ HttpUtil.get æ–¹æ³•å‘é€ HTTP GET è¯·æ±‚åˆ°å¾®ä¿¡æœåŠ¡å™¨ã€‚ //å­—ç¬¦ä¸²è½¬æˆ json JSONObject jsonObject = JSONUtil.parseObj(result);//JSONObject æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¢å¼ºçš„mapï¼Œæ‰€ä»¥å½“æˆmapç”¨,æ–¹ä¾¿ä¸€ä¼šæ‹¿é‡Œé¢éœ€è¦çš„ä¸œè¥¿ //åˆ¤æ–­æ¥å£æ˜¯å¦è¯·æ±‚æˆåŠŸ if (ObjectUtil.isNotEmpty(jsonObject.getInt(&quot;errcode&quot;))){ throw new BaseException(jsonObject.getStr(&quot;errmsg&quot;)); }// è¿”å›å®ä¾‹// {// &quot;access_token&quot;:&quot;ACCESS_TOKEN&quot;,// &quot;expires_in&quot;:7200// } return jsonObject.getStr(&quot;access_token&quot;);//æ‹¿åˆ°é‡Œé¢çš„access_tokençš„å€¼ } å¾®ä¿¡ç™»å½•æ€»ç»“ è§£é‡Šï¼š é¦–å…ˆï¼Œå‰ç«¯è°ƒç”¨äº†login æ–¹æ³•ï¼Œä¼šç»™æˆ‘ä»¬è¿”å›ä¸‰ä¸ªå‚æ•°ã€‚æˆ‘ä»¬ç«¯æ¥å—åˆ°ä¸‰ä¸ªå‚æ•°ä¹‹åï¼Œé¦–å…ˆä½¿ç”¨äº†ç™»å½•æ¥å£æ¥æ‹¿åˆ°openidè¿™ä¸ªå¾®ä¿¡çš„ä¸“å±è®¤è¯æ ‡å¿—ï¼Œä»£ç ä¸­æˆ‘ä»¬ç”¨getOpenIdå°è£…æ¥å®ç°çš„ã€‚ æ‹¿åˆ°openidä¹‹åæ¥æŸ¥è¯¢å®¢æˆ·çš„ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±è¯´æ˜ç¬¬ä¸€æ¬¡ç™»å½•ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ç„¶åèµ‹å€¼æ–°çš„openidï¼› ç„¶åæ˜¯è·å–æ‰‹æœºå·çš„æ–¹æ³•ï¼Œåœ¨ä»£ç ä¸­æˆ‘ä»¬æ˜¯é€šè¿‡ wechatService.getPhone(dto.getPhoneCode()) å°è£…åˆ°wechatServiceå®ç°ï¼Œæ‹¿åˆ°æ‰‹æœºå·ã€‚ æ‹¦æˆªå™¨å‰ç½®çŸ¥è¯† ![image-20250213115137206](/Users/gebin/Library/Application Support/typora-user-images/image-20250213115137206.png) ==æ¯ä¸ªè¯·æ±‚==éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œæå››è¿‡æ¥ä¹Ÿæ˜¯å•ç‹¬å¼€å§‹ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½ä¼šå¼€è¾Ÿä¸€å—æ–°ç©ºé—´ï¼ ![image-20250213115809329](/Users/gebin/Library/Application Support/typora-user-images/image-20250213115809329.png) ä»£ç å®ç°å¿…é¡»å®ç° ==HandlerInterceptor==ï¼Œä¼šå®ç°preHandleï¼ŒafterCompletionã€‚ä¸€èˆ¬åœ¨preHandle ä¸­ä¼šæœ‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354/** * å°ç¨‹åºç«¯tokenæ ¡éªŒ * ç»Ÿä¸€å¯¹è¯·æ±‚çš„åˆæ³•æ€§è¿›è¡Œæ ¡éªŒï¼Œéœ€è¦è¿›è¡Œ2ä¸ªæ–¹é¢çš„æ ¡éªŒï¼Œ * ä¸€ã€è¯·æ±‚å¤´ä¸­æ˜¯å¦æºå¸¦äº†authorization * äºŒã€è¯·æ±‚å¤´ä¸­æ˜¯å¦å­˜åœ¨userIdï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¯´æ˜æ˜¯éæ³•è¯·æ±‚ï¼Œå“åº”401çŠ¶æ€ç  * å¦‚æœæ˜¯åˆæ³•è¯·æ±‚ï¼Œå°†userIdå­˜å‚¨åˆ°ThreadLocalä¸­ */@Slf4j@Component@EnableConfigurationProperties(JwtTokenManagerProperties.class)public class UserInterceptor implements HandlerInterceptor { @Autowired private JwtTokenManagerProperties jwtTokenManagerProperties; //æ‰€æœ‰çš„æ ¡éªŒé€»è¾‘éƒ½æ˜¯åœ¨ å‰ç½® é‡Œé¢å†™çš„ @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { //è·å–token String token = request.getHeader(SecurityConstant.USER_TOKEN); //åˆ¤æ–­æ˜¯å¦ä¸ºç©º if (ObjectUtil.isEmpty(token)){ throw new BaseException(&quot;å°ç¨‹åº&quot;,&quot;401&quot;,null,&quot;å°ç¨‹åºtokenå¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•&quot;); } //è§£ætoken Map&lt;String,Object&gt; claims = JwtUtil.parseJWT(jwtTokenManagerProperties.getBase64EncodedSecretKey(), token); //çœ‹ä¸€ä¸‹å½“å‰çš„claimsé‡Œé¢æœ‰æ²¡æœ‰æ•°æ® if (ObjectUtil.isEmpty(claims)){ throw new BaseException(&quot;å°ç¨‹åº&quot;,&quot;401&quot;,null,&quot;å°ç¨‹åºtokenå¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•&quot;); } //è·å–æ•°æ®ï¼Œæ‹¿åˆ°ç”¨æˆ·id Long userId = MapUtil.get(claims, Constants.JWT_USERID, Long.class); if (ObjectUtil.isEmpty(userId)){ throw new BaseException(&quot;å°ç¨‹åº&quot;,&quot;401&quot;,null,&quot;å°ç¨‹åºtokenå¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•&quot;); } //å­˜å‚¨åˆ°threadlocalä¸­ UserThreadLocal.set(userId); return true; } //ä¹‹åå°±ç›´æ¥æ¸…é™¤ @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { UserThreadLocal.remove(); }} æ‹¦æˆªå™¨æ³¨å†Œ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485/** * webMvcé«˜çº§é…ç½® */@Configuration@ComponentScan(&quot;springfox.documentation.swagger.web&quot;)public class WebMvcConfig implements WebMvcConfigurer { @Autowired UserTokenIntercept userTokenIntercept; @Autowired UserInterceptor userInterceptor;//å°ç¨‹åºçš„æ‹¦æˆª //æ‹¦æˆªçš„æ—¶å€™è¿‡æ»¤æ‰swaggerç›¸å…³è·¯å¾„å’Œç™»å½•ç›¸å…³æ¥å£ private static final String[] EXCLUDE_PATH_PATTERNS = new String[]{&quot;/swagger-ui.html&quot;, &quot;/webjars/**&quot;, &quot;/swagger-resources&quot;, &quot;/v2/api-docs&quot;, // ç™»å½•æ¥å£ &quot;/customer/user/login&quot;, // æˆ¿å‹åˆ—è¡¨æ¥å£ &quot;/customer/roomTypes&quot;, &quot;/customer/orders/project/**&quot;, &quot;/user/refresh/**&quot;}; /** * æ‹¦æˆªå™¨ */ @Override public void addInterceptors(InterceptorRegistry registry) { //userTokenæ‹¦æˆª registry.addInterceptor(userTokenIntercept).excludePathPatterns(ADMIN_EXCLUDE_PATH_PATTERNS); //å°ç¨‹åºç«¯æ¥å£é‰´æƒæ‹¦æˆªå™¨ registry.addInterceptor(userInterceptor).excludePathPatterns(EXCLUDE_PATH_PATTERNS).addPathPatterns(&quot;/customer/**&quot;);//åªæ‹¦æˆªè¿™è·¯å¾„ } //æ‹¦æˆªçš„æ—¶å€™è¿‡æ»¤æ‰swaggerç›¸å…³è·¯å¾„å’Œç™»å½•ç›¸å…³æ¥å£ private static final String[] ADMIN_EXCLUDE_PATH_PATTERNS = new String[]{&quot;/swagger-ui.html&quot;, &quot;/webjars/**&quot;, &quot;/swagger-resources&quot;, &quot;/v2/api-docs&quot;, &quot;/customer/**&quot;, &quot;/security/**&quot;, &quot;/common/**&quot;, &quot;/user/refresh/**&quot;}; /** * èµ„æºè·¯å¾„ æ˜ å°„ */ @Override public void addResourceHandlers(ResourceHandlerRegistry registry) { //æ”¯æŒwebjars registry.addResourceHandler(&quot;/webjars/**&quot;) .addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;); //æ”¯æŒswagger registry.addResourceHandler(&quot;swagger-ui.html&quot;) .addResourceLocations(&quot;classpath:/META-INF/resources/&quot;); //æ”¯æŒå°åˆ€ registry.addResourceHandler(&quot;doc.html&quot;) .addResourceLocations(&quot;classpath:/META-INF/resources/&quot;); } public static final String DEFAULT_DATE_FORMAT = &quot;yyyy-MM-dd&quot;; public static final String DEFAULT_DATE_TIME_FORMAT = &quot;yyyy-MM-dd HH:mm:ss&quot;; public static final String DEFAULT_TIME_FORMAT = &quot;HH:mm:ss&quot;; @Bean public Jackson2ObjectMapperBuilderCustomizer jackson2ObjectMapperBuilderCustomizer() { return builder -&gt; { // åºåˆ—åŒ– builder.serializerByType(Long.class, ToStringSerializer.instance); builder.serializerByType(BigInteger.class, ToStringSerializer.instance); builder.serializerByType(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))); builder.serializerByType(LocalDate.class, new LocalDateSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))); builder.serializerByType(LocalTime.class, new LocalTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))); // ååºåˆ—åŒ– builder.deserializerByType(LocalDateTime.class, new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))); builder.deserializerByType(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))); builder.deserializerByType(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))); }; }} å…¶ä¸­æœ¬æ¬¡å†™çš„æ‹¦æˆªå™¨ä»£ç  å…ˆæ³¨å†Œ 12@AutowiredUserInterceptor userInterceptor;//å°ç¨‹åºçš„æ‹¦æˆª 12//å°ç¨‹åºç«¯æ¥å£é‰´æƒæ‹¦æˆªå™¨registry.addInterceptor(userInterceptor).excludePathPatterns(EXCLUDE_PATH_PATTERNS).addPathPatterns(&quot;/customer/**&quot;);//åªæ‹¦æˆªè¿™è·¯å¾„","link":"/2025/02/15/%E5%9F%BA%E7%A1%80%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/"},{"title":"æƒé™ç®¡ç†æ¨¡å—å¼€å‘","text":"æƒé™è®¤è¯æƒé™è®¤è¯åŸºç¡€ä»€ä¹ˆæ˜¯æƒé™è®¤è¯ï¼Ÿ å°±æ˜¯ä¸åŒçš„è§’è‰²èƒ½è®¿é—®åˆ°çš„é¡µé¢æ˜¯ä¸ä¸€æ ·çš„ æ¯”å¦‚ç”¨è¶…çº§ç®¡ç†å‘˜çš„è´¦æˆ·ç™»å½•çš„é¡µé¢å¦‚ä¸‹ å¯ä»¥çœ‹å‡ºï¼Œä»–æœ‰å…¨éƒ¨çš„æƒé™ã€‚ æŠ¤ç†å‘˜ç™»å½•æ—¶ï¼š è´¢åŠ¡ç™»å½•æ—¶ï¼š ![image-20250214170854273](/Users/gebin/Library/Application Support/typora-user-images/image-20250214170854273.png) å¯ä»¥çœ‹å‡ºï¼Œä¸åŒçš„è§’è‰²åˆ†é…äº†ä¸åŒçš„æƒé™ï¼Œè¿™å°±æ˜¯RBACæ¨¡å‹ï¼ˆRole Based Access Controlï¼‰ã€‚ å®Œæˆçš„æ•ˆæœå›¾ æ“ä½œçš„è¡¨ çº¢è‰²çš„è¡¨ä¸ºä¸­é—´è¡¨ï¼Œä¸€å…±æ˜¯8å¼ è¡¨ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯å·¦åŠè¾¹5å¼ ã€‚ éƒ¨é—¨ç®¡ç†éƒ¨é—¨åˆ—è¡¨æ¥å£æ¥å£åœ°å€:/dept/list è¯·æ±‚æ–¹å¼:POST è¯·æ±‚ç¤ºä¾‹: 12345{ &quot;parentDeptNo&quot;: &quot;&quot;, //çˆ¶éƒ¨é—¨ç¼–å· &quot;dataState&quot;: &quot;&quot;, //çŠ¶æ€ &quot;deptName&quot;: &quot;&quot; //éƒ¨é—¨åç§°} å“åº”ç¤ºä¾‹: 123456789101112131415161718192021222324252627282930313233343536373839{ &quot;code&quot;: 200, &quot;msg&quot;: &quot;æ“ä½œæˆåŠŸ&quot;, &quot;data&quot;: [ { &quot;id&quot;: &quot;1671445634122588250&quot;, &quot;createTime&quot;: &quot;2023-07-09 16:00:13&quot;, &quot;createDay&quot;: &quot;2023-07-09&quot;, &quot;updateTime&quot;: &quot;2023-08-25 20:21:56&quot;, &quot;createBy&quot;: &quot;1&quot;, &quot;updateBy&quot;: &quot;1671403256519078006&quot;, &quot;dataState&quot;: &quot;0&quot;, &quot;remark&quot;: &quot;å¤§æ²™å‘çš„&quot;, &quot;parentDeptNo&quot;: &quot;100001000000000&quot;, &quot;deptNo&quot;: &quot;100001030000000&quot;, &quot;deptName&quot;: &quot;é™æµ‹è¯•éƒ¨&quot;, &quot;sortNo&quot;: 0, &quot;level&quot;: 4 }, { &quot;id&quot;: &quot;1671445634122588247&quot;, &quot;createTime&quot;: &quot;2023-07-07 18:18:59&quot;, &quot;createDay&quot;: &quot;2023-07-07&quot;, &quot;updateTime&quot;: &quot;2023-07-28 17:19:19&quot;, &quot;createBy&quot;: &quot;1671403256519078006&quot;, &quot;updateBy&quot;: &quot;1671403256519078006&quot;, &quot;dataState&quot;: &quot;0&quot;, &quot;remark&quot;: &quot;&quot;, &quot;parentDeptNo&quot;: &quot;100001000000000&quot;, &quot;deptNo&quot;: &quot;100001029000000&quot;, &quot;deptName&quot;: &quot;å¤§ç®¡å®¶&quot;, &quot;sortNo&quot;: 0, &quot;leaderId&quot;: &quot;1671403256519078076&quot;, &quot;leaderName&quot;: &quot;ä½ æ˜¯æ˜¯&quot;, &quot;level&quot;: 4 } ], &quot;operationTime&quot;: &quot;2023-08-27 11:25:01&quot;} æ³¨æ„âš ï¸ï¼š åœ¨ è¯·æ±‚ç¤ºä¾‹ ä¸­çš„â€parentDeptNoâ€: â€œâ€, //çˆ¶éƒ¨é—¨ç¼–å·ï¼Œå°±æ˜¯æ ¹æ®ç‚¹å‡»æŠ˜å å°±æ˜¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼ åœ¨ å“åº”ç¤ºä¾‹ ä¸­ï¼Œâ€createDayâ€: â€œ2023-07-09â€ æ²¡æœ‰æ˜¾ç¤ºæ—¶åˆ†ç§’ï¼ŒåæœŸéœ€è¦å•ç‹¬å¤„ç†ä¸€ä¸‹ï¼ æ€è·¯ï¼š è°ƒç”¨mapperæ¥å¾—åˆ°deptéƒ¨é—¨çš„åˆ—è¡¨ï¼Œæ­¤æ—¶è¿”å›çš„æ˜¯deptç±»å‹çš„ å› ä¸ºè¿”å›çš„æ—¶å€™æ˜¯è¦ç”¨deptVoï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸€ä¸‹ éå†è¿™ä¸ªvoåˆ—è¡¨ï¼Œæ¯ä¸ªåˆ—è¡¨éƒ½è®¾ç½®æ—¥æœŸæ ¼å¼åŒ– è¿”å› æ§åˆ¶å±‚ 1234567891011121314151617181920@Slf4j@Api(tags = &quot;éƒ¨é—¨ç®¡ç†&quot;)@RestController@RequestMapping(&quot;dept&quot;)public class DeptController { @Autowired private DeptService deptService; @PostMapping(&quot;/list&quot;) @ApiImplicitParam(name = &quot;deptDto&quot;,value = &quot;éƒ¨é—¨DTOå¯¹è±¡&quot;,required = true,dataType = &quot;DeptDto&quot;) @ApiOperationSupport( includeParameters = {&quot;deptDto.dataState&quot;,&quot;deptDto.deptName&quot;,&quot;deptDto.parentDeptNo&quot;} ) public ResponseResult list(@RequestBody DeptDto deptDto){//å› ä¸ºæ˜¯postè¯·æ±‚ï¼Œæ‰€ä»¥è¦ç”¨å¯¹è±¡çš„æ–¹å¼è¿›è¡Œæ¥å— List&lt;DeptVo&gt; deptVoList = deptService.getList(deptDto); return ResponseResult.success(deptVoList); } æœåŠ¡æ¥å£ 12345678910111213/** * éƒ¨é—¨è¡¨æœåŠ¡ç±» */public interface DeptService { /** * æ¡ä»¶æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨ * @param deptDto * @return */ List&lt;DeptVo&gt; getList(DeptDto deptDto);} æœåŠ¡å®ç°ç±» 1234567891011121314151617181920/** * éƒ¨é—¨è¡¨æœåŠ¡å®ç°ç±» */@Servicepublic class DeptServiceImpl implements DeptService { @Autowired private DeptMapper deptMapper; /** * æ¡ä»¶æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨ * * @param deptDto * @return */ @Override public List&lt;DeptVo&gt; getList(DeptDto deptDto) { return deptMapper.getList(deptDto); }} 1234@Mapperpublic interface DeptMapper { List&lt;DeptVo&gt; getList(DeptDto deptDto);} Sql åˆ†æ 12345678select sd.*, su.real_name from sys_dept sd left join sys_user su on sd.leader_id = su.id; Mapper 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;mapper namespace=&quot;com.zzyl.mapper.DeptMapper&quot;&gt; &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.zzyl.entity.Dept&quot;&gt; &lt;id column=&quot;id&quot; jdbcType=&quot;BIGINT&quot; property=&quot;id&quot;/&gt; &lt;result column=&quot;parent_dept_no&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;parentDeptNo&quot;/&gt; &lt;result column=&quot;dept_no&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;deptNo&quot;/&gt; &lt;result column=&quot;dept_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;deptName&quot;/&gt; &lt;result column=&quot;sort_no&quot; jdbcType=&quot;INTEGER&quot; property=&quot;sortNo&quot;/&gt; &lt;result column=&quot;data_state&quot; jdbcType=&quot;CHAR&quot; property=&quot;dataState&quot;/&gt; &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot;/&gt; &lt;result column=&quot;update_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;updateTime&quot;/&gt; &lt;result column=&quot;create_by&quot; jdbcType=&quot;BIGINT&quot; property=&quot;createBy&quot;/&gt; &lt;result column=&quot;update_by&quot; jdbcType=&quot;BIGINT&quot; property=&quot;updateBy&quot;/&gt; &lt;result column=&quot;leader_id&quot; jdbcType=&quot;BIGINT&quot; property=&quot;leaderId&quot;/&gt; &lt;result column=&quot;leader_name&quot; jdbcType=&quot;BIGINT&quot; property=&quot;leaderName&quot;/&gt; &lt;/resultMap&gt; &lt;resultMap id=&quot;BaseResultVoMap&quot; type=&quot;com.zzyl.vo.DeptVo&quot;&gt; &lt;id column=&quot;id&quot; jdbcType=&quot;BIGINT&quot; property=&quot;id&quot;/&gt; &lt;result column=&quot;parent_dept_no&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;parentDeptNo&quot;/&gt; &lt;result column=&quot;dept_no&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;deptNo&quot;/&gt; &lt;result column=&quot;dept_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;deptName&quot;/&gt; &lt;result column=&quot;sort_no&quot; jdbcType=&quot;INTEGER&quot; property=&quot;sortNo&quot;/&gt; &lt;result column=&quot;data_state&quot; jdbcType=&quot;CHAR&quot; property=&quot;dataState&quot;/&gt; &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot;/&gt; &lt;result column=&quot;update_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;updateTime&quot;/&gt; &lt;result column=&quot;create_by&quot; jdbcType=&quot;BIGINT&quot; property=&quot;createBy&quot;/&gt; &lt;result column=&quot;update_by&quot; jdbcType=&quot;BIGINT&quot; property=&quot;updateBy&quot;/&gt; &lt;result column=&quot;leader_id&quot; jdbcType=&quot;BIGINT&quot; property=&quot;leaderId&quot;/&gt; &lt;result column=&quot;role_id&quot; jdbcType=&quot;BIGINT&quot; property=&quot;roleId&quot;/&gt; &lt;/resultMap&gt; &lt;select id=&quot;getList&quot; resultType=&quot;com.zzyl.vo.DeptVo&quot;&gt; select d.id, d.parent_dept_no, d.dept_no, d.dept_name, d.sort_no, d.data_state, d.create_time, d.update_time, d.create_by, d.update_by, d.remark, d.leader_id , u.real_name as leader_name,DATE_FORMAT(d.create_time,'%Y-%m-%d') as create_day from sys_dept d left join sys_user u on u.id = leader_id &lt;where&gt; &lt;if test=&quot;deptName!=null and deptName!=''&quot;&gt; and d.dept_name like concat('%',#{deptName},'%') &lt;/if&gt; &lt;if test=&quot;parentDeptNo!=null and parentDeptNo!=''&quot;&gt; and d.parent_dept_no like concat(#{parentDeptNo},'%') &lt;/if&gt; &lt;if test=&quot;dataState!=null and dataState!=''&quot;&gt; and d.data_state=#{dataState} &lt;/if&gt; &lt;/where&gt; order by d.sort_no asc, d.create_time desc &lt;/select&gt;&lt;/mapper&gt; å…¶ä¸­é‡ç‚¹çš„å°±æ˜¯ DATE_FORMAT(d.create_time,â€™%Y-%m-%dâ€™) å› ä¸ºå‰ç«¯é¡µé¢ä¸Šä¸éœ€è¦å±•ç¤ºå’Œå…·ä½“çš„æ˜¯ååˆ†ç§’ï¼Œæ‰€ä»¥è¦æ ¼å¼åŒ–ä¸€ä¸‹ã€‚ u.id = leader_id å› ä¸ºå±•ç¤ºçš„æ—¶å€™æœ‰éƒ¨é—¨è´Ÿè´£äººæ‰€ä»¥è¦å…³è”ä¸€ä¸‹è¡¨ã€‚ éƒ¨é—¨æ ‘å½¢ç»“æ„æ¥å£ğŸŒŸ éš¾ç‚¹åœ¨äºå¦‚ä½•æŠŠå®ƒç»„è£…æˆä¸€é¢—æ ‘ï¼š ç”±äºæ˜¯åˆå§‹åŒ–éƒ¨é—¨çš„æ ‘å½¢ç»“æ„ï¼Œè¿™ä¸ªæ¥å£éœ€è¦åœ¨éƒ¨é—¨ä¸­å»å®šä¹‰ æ¥å£åœ°å€:/dept/tree è¯·æ±‚æ–¹å¼:POST è¯·æ±‚ç¤ºä¾‹: æ—  å“åº”ç¤ºä¾‹: 1234567891011121314151617181920212223242526272829303132{ &quot;code&quot;: 200, &quot;msg&quot;: &quot;æ“ä½œæˆåŠŸ&quot;, &quot;data&quot;: { &quot;items&quot;: [ { &quot;id&quot;: &quot;100001000000000&quot;, &quot;label&quot;: &quot;æ™ºæ…§å…»è€é™¢&quot;, &quot;children&quot;: [ { &quot;id&quot;: &quot;100001001000000&quot;, &quot;label&quot;: &quot;é™¢é•¿åŠå…¬å®¤&quot; }, { &quot;id&quot;: &quot;100001002000000&quot;, &quot;label&quot;: &quot;è´¢åŠ¡éƒ¨&quot;, &quot;children&quot;: [ { &quot;id&quot;: &quot;100001002001000&quot;, &quot;label&quot;: &quot;ä¼šè®¡ç»„&quot; }, { &quot;id&quot;: &quot;100001002002000&quot;, &quot;label&quot;: &quot;ç»“ç®—ç»„&quot; } ] } ] } ] }} å¾—ç”¨é€’å½’çš„æ–¹æ³• ï¼š åˆ†æ items æ˜¯ä¸€ä¸ªé›†åˆï¼Œé›†åˆä¸­åˆåˆå¯¹è±¡ï¼Œå¯¹è±¡ä¸­åˆæœ‰å¦å¤–ä¸€ä¸ªé›†åˆã€‚ æ‰€ä»¥è¯´åœ¨è®¾è®¡è¿”å›å€¼çš„æ—¶å€™ã€‚ 12345678910public class TreeVo implements Serializable { @ApiModelProperty(value = &quot;treeæ•°æ®&quot;) private List&lt;TreeItemVo&gt; items; @Builder public TreeVo(List&lt;TreeItemVo&gt; items) { this.items = items; }} 12345678910public class TreeItemVo implements Serializable { @ApiModelProperty(value = &quot;èŠ‚ç‚¹ID&quot;) public String id; @ApiModelProperty(value = &quot;æ˜¾ç¤ºå†…å®¹&quot;) public String label; @ApiModelProperty(value = &quot;æ˜¾ç¤ºå†…å®¹&quot;) public List&lt;TreeItemVo&gt; children = new ArrayList&lt;&gt;();//åˆåŒ…å«è‡ªå·± é›†åˆä¹‹ä¸­è£…çš„åˆæ˜¯å®ƒæœ¬èº«ã€‚ æ€è·¯ï¼š å…ˆæ‹¿åˆ°æœ€æ ¹éƒ¨é—¨çš„ç¼–å·ï¼Œæˆ‘ä»¬è®¾è®¡äº†å›ºå®šå€¼ã€‚ æ„å»ºä¸€ä¸ªDeptDto,èµ‹å€¼èµ‹éƒ¨é—¨ç¼–å·ï¼ŒçŠ¶æ€ä¸º0ï¼Œçˆ¶éƒ¨é—¨ç¼–å·å¤„ç†ä¸€ä¸‹è®¾ç½®è¿›å»ï¼Œä¸€ä¼šä¸‹é¢æ–¹æ³•è¦ç”¨è¿™ä¸ªç±»å‹çš„å‚æ•° è°ƒç”¨æ–¹æ³•ä¼ è¿›å»dtoæ‹¿åˆ°éƒ¨é—¨æ‰€æœ‰æ•°æ® æ£€æŸ¥å½“æ‹¿åˆ°çš„æ•°æ®æ˜¯å¦ä¸ºç©ºï¼Œå¦åˆ™æŠ¥é”™ æ„å»ºä¸€ä¸ªç©ºæ‰€å»ºæ•°æ®ç»“æ„çš„ç±»å‹çš„ï¼Œä¸€ä¼šå‡†å¤‡å¥½å‡†å¤‡è£…é…è¿”å› ä»æ‰€æœ‰éƒ¨é—¨æ•°æ®çš„é‡Œé¢éå†æ‹¿åˆ°æ ¹ä¸‹çš„ç¬¬ä¸€ä¸ªæ•°æ®æ‰æ˜¯æˆ‘ä»¬è®¾ç½®çš„â€œæ ¹â€ï¼Œä¹Ÿå°±æ˜¯çˆ¶éƒ¨é—¨æ˜¯ä¸Šé¢æ‹¿åˆ°çš„å›ºå®šå€¼çš„é‚£ä¸ªã€‚ âš ï¸é€’å½’è°ƒç”¨ç»„è£…æ•°æ®ï¼Œä¼ å…¥ä¸Šé¢å®šä¹‰çš„è¦ï¼ˆå­˜æ”¾é€’å½’ç”Ÿæˆçš„å­èŠ‚ç‚¹ï¼Œæ ¹çš„æ•°æ®ã€æ€»çš„æ•°æ®ï¼‰ æ„å»ºæ ¹éƒ¨é—¨å¯¹è±¡ç±»å‹æŠŠé‡Œé¢çš„å€¼è®¾ç½®è¿›å» æ‰¾å­é›†ï¼Œæ ¹æ®å½“å‰éƒ¨é—¨çš„ç¼–å·ä½œä¸ºçˆ¶éƒ¨é—¨çš„ç¼–å·ï¼Œéå†æ¯ä¸ªæ•°æ®ï¼Œæ‰¾åˆ°çˆ¶éƒ¨é—¨æ˜¯å½“å‰å°è£…å¥½çš„èŠ‚ç‚¹çš„éƒ¨é—¨é›†åˆ åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºå°±æ˜¯æœ‰å­ æ„å»ºä¸€ä¸ªè£…å­éƒ¨é—¨çš„åˆ—è¡¨ æŠŠå½“å‰æ‹¿åˆ°çš„å­éƒ¨é—¨è¿›è¡Œéå†ï¼Œç»§ç»­æ‰¾å­éƒ¨é—¨ï¼Œæ‰¾ä¸åˆ°ä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯ä¾æ®å½“å‰çš„è¿›è¡Œéå† ä¸ºäº†ç»„è£…è¿”å›å€¼itemé‡Œé¢çš„æ•°æ®è¿”å› 123456@PostMapping(&quot;/tree&quot;)public ResponseResult&lt;TreeVo&gt; deptTree(){ TreeVo treeVo = deptService.deptTree(); return ResponseResult.success(treeVo);} 12345/** * æŸ¥è¯¢éƒ¨é—¨æ ‘å½¢ç»“æ„ * @return */ TreeVo deptTree(); å®ç° 1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * æŸ¥è¯¢éƒ¨é—¨æ ‘å½¢ç»“æ„ * * @return */ @Override public TreeVo deptTreeVo() { String rootDeptParentId = SuperConstant.ROOT_DEPT_PARENT_ID; DeptDto deptDto = DeptDto.builder().parentDeptNo(rootDeptParentId).build(); List&lt;DeptVo&gt; deptVoList = findDeptList(deptDto);//æ‹¿åˆ°äº†æ‰€æœ‰çš„éƒ¨é—¨ //åˆ›ä¸€ä¸ªæ–°çš„ List&lt;TreeItemVo&gt; items = new ArrayList&lt;&gt;();//å¾…ç»„è£…çš„ DeptVo rootDept = deptVoList.stream().filter(d -&gt; d.getParentDeptNo().equals(rootDeptParentId)).collect(Collectors.toList()).get(0); recursionTreeItem(items,rootDept,deptVoList); return TreeVo.builder().items(items).build(); } /** * é€’å½’ * @param items * @param rootDept * @param deptVoList */ private void recursionTreeItem(List&lt;TreeItemVo&gt; items, DeptVo rootDept, List&lt;DeptVo&gt; deptVoList) { //æ ¹æ®å®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œæ„å»ºå‡ºå«æœ‰åç§°å’ŒIDçš„é‚£ä¸ª TreeItemVo treeItemVo = TreeItemVo.builder().id(rootDept.getDeptNo()).label(rootDept.getDeptName()).build(); //æ ¹æ®å½“å‰éƒ¨é—¨çš„ç¼–å·ä¸ºçˆ¶éƒ¨é—¨ç¼–å·ï¼Œæ‰¾åˆ°ä»–çš„å­é›† List&lt;DeptVo&gt; childrenList = deptVoList.stream().filter(d -&gt; d.getParentDeptNo().equals(rootDept.getDeptNo())).collect(Collectors.toList()); //åˆ¤æ–­æ˜¯å¦ä¸ºç©º if (!EmptyUtil.isNullOrEmpty(childrenList)){ List&lt;TreeItemVo&gt; listChildrenList = new ArrayList&lt;&gt;(); //è¿›è¡Œéå†æ¯ä¸€ä¸ª childrenList.forEach( dept -&gt; { recursionTreeItem(listChildrenList,dept,deptVoList); }); } items.add(treeItemVo); } éƒ¨é—¨æ·»åŠ æ¥å£åœ°å€:/dept è¯·æ±‚æ–¹å¼:PUT æ¥å£æè¿°:éƒ¨é—¨æ·»åŠ  è¯·æ±‚ç¤ºä¾‹: 12345678{ &quot;dataState&quot;: &quot;&quot;,//éƒ¨é—¨çŠ¶æ€ &quot;deptName&quot;: &quot;&quot;,//éƒ¨é—¨åç§° &quot;leaderId&quot;: 0, // éƒ¨é—¨è´Ÿè´£äººid &quot;parentDeptNo&quot;: &quot;&quot;, //ä¸Šçº§éƒ¨é—¨ç¼–å· &quot;remark&quot;: &quot;&quot;, //éƒ¨é—¨è¯´æ˜ &quot;sortNo&quot;: 0 //æ’åº} å“åº”ç¤ºä¾‹: 123456{ &quot;code&quot;: 0, &quot;data&quot;: true, &quot;msg&quot;: &quot;&quot;, &quot;operationTime&quot;: &quot;&quot;} è¾“å…¥æ¡†é‡Œé¢çš„å‚æ•°éƒ½èƒ½ä¸è¯·æ±‚ç¤ºä¾‹ç›¸åŒ¹é…ã€‚ æ€è·¯ï¼š ç”±äºdtoæ•°æ®ä¸å…¨ï¼Œè¿›è¡Œè½¬æ¢æˆæ ‡å¿—çš„ æ ¹æ®çˆ¶éƒ¨é—¨çš„ç¼–å·ç”Ÿæˆä¸€ä¸ªå­éƒ¨é—¨ç¼–å· éƒ¨é—¨ä¸èƒ½è¶…è¿‡4çº§ï¼Œåˆ©ç”¨ä¸‹é¢çš„ç®—æ³•åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœç­‰äº5å°±ä»£è¡¨è¶…è¿‡äº†4çº§ï¼Œè¶…è¿‡å°±æŠ¥é”™ åˆ©ç”¨çˆ¶éƒ¨é—¨ç¼–å·ç”Ÿæˆä¸€ä¸ªéƒ¨é—¨çš„dtoä¸‹é¢è¦æ ¹æ®dtoæ¥æŸ¥è¯¢è¿™ä¸ªçˆ¶éƒ¨é—¨ä¸‹çš„å­æ‰€æœ‰å­éƒ¨é—¨ è°ƒç”¨æ–¹æ³•æ‰¾åˆ°çˆ¶éƒ¨é—¨ä¸‹çš„å­æ‰€æœ‰å­éƒ¨é—¨ å¦‚æœå­éƒ¨é—¨ä¸ºç©ºå°±ä»£è¡¨å¾—åˆ›å»ºä¸€ä¸ªå­éƒ¨é—¨ï¼Œå°±æ˜¯è°ƒç”¨æ–¹æ³•ï¼ŒæŠŠçˆ¶éƒ¨é—¨ç¼–å·æ‰”è¿›å»å°±ä¼šå¾—åˆ°å­ å¦åˆ™å°±æ ¹æ®æœ‰çš„å­éƒ¨é—¨è¿›è¡Œç´¯åŠ ï¼Œéå†å­éƒ¨é—¨æŠŠæ¯ä¸€ä¸ªå­éƒ¨é—¨å˜è¿”å›æ¯”è¾ƒæœ€å¤§çš„ è°ƒç”¨createNoæ–¹æ³•æ¥è¾“å…¥è¿›å»ç”Ÿæˆ è®¾ç½®è¿›å»æ–°çš„éƒ¨é—¨ç¼–å· è°ƒç”¨mapperè¿›è¡Œä¿å­˜æ“ä½œ å¦‚æœflag == 1 åˆ™å°±æ˜¯å¤±è´¥äº† å¦åˆ™å°±æ˜¯true æ§åˆ¶å±‚ 123456789101112131415@PutMapping @ApiOperation(value = &quot;éƒ¨é—¨æ·»åŠ &quot;,notes = &quot;éƒ¨é—¨æ·»åŠ &quot;) @ApiImplicitParam(name = &quot;deptDto&quot;,value = &quot;éƒ¨é—¨DTOå¯¹è±¡&quot;,required = true,dataType = &quot;DeptDto&quot;) @ApiOperationSupport(includeParameters = { &quot;deptDto.dataState&quot;, &quot;deptDto.deptName&quot;, &quot;deptDto.leaderId&quot;, &quot;deptDto.remark&quot;, &quot;deptDto.sortNo&quot;, &quot;deptDto.parentDeptNo&quot;}) public ResponseResult&lt;DeptVo&gt; createDpt(@RequestBody DeptDto deptDto){ //åˆ›å»ºæˆåŠŸ true å’Œ false Boolean flag = deptService.createDpt(deptDto); return ResponseResult.success(flag); } æœåŠ¡å±‚ 123456/** * æ·»åŠ éƒ¨é—¨ * @param deptDto * @return */ Boolean createDpt(DeptDto deptDto); 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364/** * æ·»åŠ éƒ¨é—¨ * * @param deptDto * @return */ @Override public Boolean createDpt(DeptDto deptDto) { //è¿›è¡Œæ•°æ®è½¬æ¢ Dept dept = BeanUtil.copyProperties(deptDto, Dept.class); //æ ¹æ®çˆ¶éƒ¨é—¨ç¼–å·ç”Ÿæˆå½“å‰éƒ¨é—¨ç¼–å· // 100001000000000 // æƒ…å†µ1 ï¼š å½“å‰çˆ¶éƒ¨é—¨ç¼–å·ï¼Œæ²¡æœ‰å­éƒ¨é—¨ 100001001000000 // æƒ…å†µ2 ï¼š å½“å‰æœ‰å­éƒ¨é—¨ï¼Œ 100001001000000 100001002000000 100001003000000 //ä¼ å…¥çˆ¶éƒ¨é—¨ï¼Œå¾—åˆ°å­éƒ¨é—¨ String deptNo = createDptNo(deptDto.getParentDeptNo()); //é‡æ–°è®¾ç½®è¿›å» dept.setDeptNo(deptNo); //ä¿å­˜ int flag = deptMapper.insert(dept);//è¿”å›çš„æ˜¯å½±å“çš„è¡Œæ•° if (flag != 1){ throw new BaseException(&quot;ä¿å­˜éƒ¨é—¨ä¸æˆåŠŸ&quot;); } return true;}/** * ç”Ÿæˆéƒ¨é—¨ç¼–å· * @param parentDeptNo * @return */ private String createDptNo(String parentDeptNo) { //100001001001001 ---&gt; 100001001001001 15ä½ ä»£è¡¨ 5 çº§ 15/3 //100001001001000 ---&gt; 100001001001 12ä½ ä»£è¡¨ 4 çº§ //100001001000000 ---&gt; 100001001 9ä½ ä»£è¡¨ 3 çº§ if (NoProcessing.processString(parentDeptNo).length() / 3 == 5){ throw new BaseException(&quot;éƒ¨é—¨ä¸èƒ½è¶…è¿‡4çº§&quot;); } //æŸ¥è¯¢ä¸€ä¸‹æœ‰æ²¡æœ‰éƒ¨é—¨ DeptDto deptDto = DeptDto.builder().parentDeptNo(parentDeptNo).build(); List&lt;DeptVo&gt; deptVoList = deptMapper.getList(deptDto); if (EmptyUtil.isNullOrEmpty(deptVoList)){ //æƒ…å†µ1 ï¼š å½“å‰çˆ¶éƒ¨é—¨ç¼–å·ï¼Œæ²¡æœ‰å­éƒ¨é—¨ 100001001000000 return NoProcessing.createNo(parentDeptNo,false); } else { //æƒ…å†µ2 ï¼š å½“å‰æœ‰å­éƒ¨é—¨ï¼Œ 100001001000000 100001002000000 100001003000000 //å…ˆ æƒ³åŠæ³•æ‹¿åˆ°æœ€åä¸€ä¸ª ç„¶åå† + 1 Long aLong = deptVoList.stream().map(d -&gt; { return Long.valueOf(d.getDeptNo()); }).max(Comparator.comparing(i -&gt; i)).get();//æ‹¿åˆ°äº†æœ€å¤§çš„éƒ¨é—¨ç¼–å· return NoProcessing.createNo(String.valueOf(aLong),true); } } mapper 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;insert id=&quot;insert&quot; parameterType=&quot;com.zzyl.entity.Dept&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;&gt; insert into sys_dept &lt;trim prefix=&quot;(&quot; suffix=&quot;)&quot; suffixOverrides=&quot;,&quot;&gt; &lt;if test=&quot;parentDeptNo != null&quot;&gt; parent_dept_no, &lt;/if&gt; &lt;if test=&quot;deptNo != null&quot;&gt; dept_no, &lt;/if&gt; &lt;if test=&quot;deptName != null&quot;&gt; dept_name, &lt;/if&gt; &lt;if test=&quot;sortNo != null&quot;&gt; sort_no, &lt;/if&gt; &lt;if test=&quot;dataState != null&quot;&gt; data_state, &lt;/if&gt; &lt;if test=&quot;createTime != null&quot;&gt; create_time, &lt;/if&gt; &lt;if test=&quot;updateTime != null&quot;&gt; update_time, &lt;/if&gt; &lt;if test=&quot;createBy != null&quot;&gt; create_by, &lt;/if&gt; &lt;if test=&quot;updateBy != null&quot;&gt; update_by, &lt;/if&gt; &lt;if test=&quot;leaderId != null&quot;&gt; leader_id, &lt;/if&gt; &lt;if test=&quot;remark != null&quot;&gt; remark, &lt;/if&gt; &lt;/trim&gt; &lt;trim prefix=&quot;values (&quot; suffix=&quot;)&quot; suffixOverrides=&quot;,&quot;&gt; &lt;if test=&quot;parentDeptNo != null&quot;&gt; #{parentDeptNo,jdbcType=VARCHAR}, &lt;/if&gt; &lt;if test=&quot;deptNo != null&quot;&gt; #{deptNo,jdbcType=VARCHAR}, &lt;/if&gt; &lt;if test=&quot;deptName != null&quot;&gt; #{deptName,jdbcType=VARCHAR}, &lt;/if&gt; &lt;if test=&quot;sortNo != null&quot;&gt; #{sortNo,jdbcType=INTEGER}, &lt;/if&gt; &lt;if test=&quot;dataState != null&quot;&gt; #{dataState,jdbcType=CHAR}, &lt;/if&gt; &lt;if test=&quot;createTime != null&quot;&gt; #{createTime,jdbcType=TIMESTAMP}, &lt;/if&gt; &lt;if test=&quot;updateTime != null&quot;&gt; #{updateTime,jdbcType=TIMESTAMP}, &lt;/if&gt; &lt;if test=&quot;createBy != null&quot;&gt; #{createBy,jdbcType=BIGINT}, &lt;/if&gt; &lt;if test=&quot;updateBy != null&quot;&gt; #{updateBy,jdbcType=BIGINT}, &lt;/if&gt; &lt;if test=&quot;leaderId != null&quot;&gt; #{leaderId,jdbcType=BIGINT}, &lt;/if&gt; &lt;if test=&quot;remark != null&quot;&gt; #{remark,jdbcType=VARCHAR} &lt;/if&gt; &lt;/trim&gt; &lt;/insert&gt; éƒ¨é—¨ä¿®æ”¹æ¥å£åœ°å€:/dept è¯·æ±‚æ–¹å¼:PATCH è¯·æ±‚ç¤ºä¾‹: 123456789{ &quot;dataState&quot;: &quot;&quot;,//éƒ¨é—¨çŠ¶æ€ &quot;deptName&quot;: &quot;&quot;,//éƒ¨é—¨åç§° &quot;leaderId&quot;: 0, // éƒ¨é—¨è´Ÿè´£äººid &quot;parentDeptNo&quot;: &quot;&quot;, //ä¸Šçº§éƒ¨é—¨ç¼–å· &quot;remark&quot;: &quot;&quot;, //éƒ¨é—¨è¯´æ˜ &quot;sortNo&quot;: 0, //æ’åº &quot;id&quot;:1671445634122588232 // ä¸»é”®} å“åº”ç¤ºä¾‹: 123456{ &quot;code&quot;: 0, &quot;data&quot;: true, &quot;msg&quot;: &quot;&quot;, &quot;operationTime&quot;: &quot;&quot;} ğŸ’¡æ€è·¯: å…ˆè½¬æ¢æˆæ ‡å‡†çš„ç±»å‹ æ£€éªŒæ˜¯å¦å¯ä»¥ä¿®æ”¹ï¼Œæ£€æŸ¥æ˜¯å¦ä¸º1 æ˜¯ç¦ç”¨ æ£€æŸ¥è¯¥éƒ¨é—¨ä¸‹æ˜¯å¦å­˜åœ¨å­éƒ¨é—¨ æ£€æŸ¥è¯¥éƒ¨é—¨æ˜¯å¦å­˜åœ¨ç”¨æˆ· è°ƒç”¨æ–¹æ³•è¿›è¡Œä¿®æ”¹ éªŒè¯ä¿®æ”¹ç»“æœæ˜¯å¦ä¸º0ï¼Œè¡¨ç¤ºä¿®æ”¹å¤±è´¥ ä»£ç å®ç° 1234567891011121314151617181920public Boolean updateDept(DeptDto deptDto) { Dept dept = BeanUtil.toBean(deptDto, Dept.class); if (dept.getDataState().equals(&quot;1&quot;)){ //æ£€æŸ¥è¯¥éƒ¨é—¨ä¸‹æ˜¯å¦å­˜åœ¨å­éƒ¨é—¨ if (hasChildByDeptId(dept.getDeptNo())){ throw new RuntimeException(&quot;å­˜åœ¨ä¸‹çº§éƒ¨é—¨,ä¸å…è®¸ç¦ç”¨&quot;); } if (checkDeptExistUser(dept.getDeptNo())){ throw new RuntimeException(&quot;éƒ¨é—¨å­˜åœ¨ç”¨æˆ·,ä¸å…è®¸ç¦ç”¨&quot;); } } int flag = deptMapper.insert(dept); if (flag == 0){ throw new RuntimeException(&quot;ä¿®æ”¹éƒ¨é—¨å¤±è´¥ï¼&quot;); } return true; } 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970&lt;insert id=&quot;insert&quot; parameterType=&quot;com.zzyl.entity.Dept&quot;&gt; &lt;selectKey keyProperty=&quot;id&quot; order=&quot;AFTER&quot; resultType=&quot;java.lang.Long&quot;&gt; # å°†æŸ¥è¯¢åˆ°çš„ä¸»å»ºèµ‹å€¼ç»™id SELECT LAST_INSERT_ID() # keyPropertyæ˜¯å°†idå€¼è‡ªå¢ &lt;/selectKey&gt; insert into sys_dept &lt;trim prefix=&quot;(&quot; suffix=&quot;)&quot; suffixOverrides=&quot;,&quot;&gt; &lt;if test=&quot;parentDeptNo != null&quot;&gt; parent_dept_no, &lt;/if&gt; &lt;if test=&quot;deptNo != null&quot;&gt; dept_no, &lt;/if&gt; &lt;if test=&quot;deptName != null&quot;&gt; dept_name, &lt;/if&gt; &lt;if test=&quot;sortNo != null&quot;&gt; sort_no, &lt;/if&gt; &lt;if test=&quot;dataState != null&quot;&gt; data_state, &lt;/if&gt; &lt;if test=&quot;createTime != null&quot;&gt; create_time, &lt;/if&gt; &lt;if test=&quot;updateTime != null&quot;&gt; update_time, &lt;/if&gt; &lt;if test=&quot;createBy != null&quot;&gt; create_by, &lt;/if&gt; &lt;if test=&quot;updateBy != null&quot;&gt; update_by, &lt;/if&gt; &lt;if test=&quot;leaderId != null&quot;&gt; leader_id, &lt;/if&gt; &lt;/trim&gt; &lt;trim prefix=&quot;values (&quot; suffix=&quot;)&quot; suffixOverrides=&quot;,&quot;&gt; &lt;if test=&quot;parentDeptNo != null&quot;&gt; #{parentDeptNo,jdbcType=VARCHAR}, &lt;/if&gt; &lt;if test=&quot;deptNo != null&quot;&gt; #{deptNo,jdbcType=VARCHAR}, &lt;/if&gt; &lt;if test=&quot;deptName != null&quot;&gt; #{deptName,jdbcType=VARCHAR}, &lt;/if&gt; &lt;if test=&quot;sortNo != null&quot;&gt; #{sortNo,jdbcType=INTEGER}, &lt;/if&gt; &lt;if test=&quot;dataState != null&quot;&gt; #{dataState,jdbcType=CHAR}, &lt;/if&gt; &lt;if test=&quot;createTime != null&quot;&gt; #{createTime,jdbcType=TIMESTAMP}, &lt;/if&gt; &lt;if test=&quot;updateTime != null&quot;&gt; #{updateTime,jdbcType=TIMESTAMP}, &lt;/if&gt; &lt;if test=&quot;createBy != null&quot;&gt; #{createBy,jdbcType=BIGINT}, &lt;/if&gt; &lt;if test=&quot;updateBy != null&quot;&gt; #{updateBy,jdbcType=BIGINT}, &lt;/if&gt; &lt;if test=&quot;leaderId != null&quot;&gt; #{leaderId,jdbcType=BIGINT}, &lt;/if&gt; &lt;/trim&gt; &lt;/insert&gt; æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å­éƒ¨é—¨123456789101112131415select count(*) from sys_dept where parent_dept_no = '100001009000000'; &lt;select id=&quot;hasChildByDeptId&quot; parameterType=&quot;java.lang.String&quot; resultType=&quot;int&quot;&gt; select count(1) from sys_dept where `parent_dept_no` = #{deptId} limit 1 &lt;/select&gt; count(1) æ¯” count(*) æ€§èƒ½æ›´å¥½ï¼Œé…åˆ limit 1ï¼Œä½†å‡¡æŸ¥åˆ°å­˜åœ¨ä¸€ä¸ªå­éƒ¨é—¨é©¬ä¸Šå°±åœæ­¢ï¼ æŸ¥çœ‹å½“å‰éƒ¨é—¨ä¸‹å¦å­˜åœ¨ç”¨æˆ·123456select * from sys_user where dept_no = '100001005000000'; å¯ç”¨/ç¦ç”¨æ¥å£åœ°å€:/dept/is_enable è¯·æ±‚æ–¹å¼:PATCH è¯·æ±‚ç¤ºä¾‹: 1234{ &quot;dataState&quot;: &quot;&quot;, //çŠ¶æ€ &quot;id&quot;: 1671445634122588232} å“åº”ç¤ºä¾‹: 123456{ &quot;code&quot;: 0, &quot;data&quot;: true, &quot;msg&quot;: &quot;&quot;, &quot;operationTime&quot;: &quot;&quot;} æ€è·¯ğŸ’¡ï¼š æ ¹æ®éƒ¨é—¨ç¼–å·æŸ¥è¯¢æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨éƒ¨é—¨ å¦‚æœè¯¥éƒ¨é—¨ä¸ºnullï¼ŒæŠ¥é”™è¡¨ç¤ºéƒ¨é—¨ä¸å­˜åœ¨ æŠŠå¯¹è±¡è®¾ç½®è¿›å»æ–°çš„çŠ¶æ€ è°ƒç”¨mapperè¿›è¡Œä¿®æ”¹ å¦‚æœä¿®æ”¹ç»“æœ==0ä»£è¡¨ä¿®æ”¹å¤±è´¥ å®ç° 123456789101112131415161718192021222324252627/** * å¯ç”¨-ç¦ç”¨éƒ¨é—¨ * * @param deptDto * @return */ @Caching(evict = {@CacheEvict(value = DeptCacheConstant.LIST,allEntries = true), @CacheEvict(value = DeptCacheConstant.TREE,allEntries = true)}) @Override public Boolean isEnable(DeptDto deptDto) { //æ ¹æ®éƒ¨é—¨ç¼–å·æŸ¥è¯¢æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨éƒ¨é—¨ Dept dept = deptMapper.selectByDeptNo(deptDto.getDeptNo()); //å¦‚æœä¸ºnullï¼ŒæŠ¥é”™ä»£è¡¨éƒ¨é—¨ä¸å­˜åœ¨ if (dept == null){ throw new BaseException(&quot;è¿™ä¸ªéƒ¨é—¨å¯æ˜¯ä¸å­˜åœ¨å•Šï¼&quot;); } dept.setDataState(deptDto.getDataState()); //è°ƒç”¨mapperè¿›è¡Œä¿®æ”¹ int flag = deptMapper.updateByPrimaryKey(dept); if (flag == 0){ throw new RuntimeException(&quot;ä¿®æ”¹å¤±è´¥äº†ï½ï½ï½ï½&quot;); } return true; } å²—ä½ç®¡ç†æŒ‰ç…§éƒ¨é—¨æŸ¥è¯¢æ‰€æœ‰çš„å²—ä½åˆ—è¡¨æ¥å£åœ°å€:/post/page/{pageNum}/{pageSize} è¯·æ±‚æ–¹å¼:POST è¯·æ±‚ç¤ºä¾‹: 12345{ &quot;deptNo&quot;: &quot;&quot;,//éƒ¨é—¨ç¼–å· &quot;dataState&quot;: &quot;&quot;,//å²—ä½çŠ¶æ€ &quot;postName&quot;: &quot;&quot;//å²—ä½åç§°} å“åº”ç¤ºä¾‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364{ &quot;code&quot;: 200, &quot;msg&quot;: &quot;æ“ä½œæˆåŠŸ&quot;, &quot;data&quot;: { &quot;total&quot;: &quot;2&quot;, &quot;pageSize&quot;: 10, &quot;pages&quot;: &quot;1&quot;, &quot;page&quot;: 1, &quot;records&quot;: [ { &quot;id&quot;: &quot;1671446178337726569&quot;, &quot;createTime&quot;: &quot;2023-07-11 10:30:25&quot;, &quot;createDay&quot;: &quot;2023-07-11&quot;, &quot;createBy&quot;: &quot;1671403256519078006&quot;, &quot;dataState&quot;: &quot;0&quot;, &quot;remark&quot;: &quot;&quot;, &quot;deptNo&quot;: &quot;100001005000000&quot;, &quot;postNo&quot;: &quot;100001005002000&quot;, &quot;postName&quot;: &quot;è´¢åŠ¡ä¸»ç®¡&quot;, &quot;deptVo&quot;: { &quot;id&quot;: &quot;1671445634122588164&quot;, &quot;createTime&quot;: &quot;2023-06-22 11:42:36&quot;, &quot;updateTime&quot;: &quot;2023-06-30 09:14:16&quot;, &quot;createBy&quot;: &quot;1671362878457892866&quot;, &quot;updateBy&quot;: &quot;1&quot;, &quot;dataState&quot;: &quot;0&quot;, &quot;remark&quot;: &quot;å•Šå®æ‰“å®æ‰“é˜¿è¨å¾·é˜¿è¨å¾·æŒ‰æ—¶&quot;, &quot;parentDeptNo&quot;: &quot;100001000000000&quot;, &quot;deptNo&quot;: &quot;100001005000000&quot;, &quot;deptName&quot;: &quot;è´¢åŠ¡éƒ¨&quot;, &quot;sortNo&quot;: 2, &quot;leaderId&quot;: &quot;1671403256519077890&quot;, &quot;level&quot;: 4 } }, { &quot;id&quot;: &quot;1671446178337726568&quot;, &quot;createTime&quot;: &quot;2023-07-11 10:30:14&quot;, &quot;createDay&quot;: &quot;2023-07-11&quot;, &quot;createBy&quot;: &quot;1671403256519078006&quot;, &quot;dataState&quot;: &quot;0&quot;, &quot;deptNo&quot;: &quot;100001005000000&quot;, &quot;postNo&quot;: &quot;100001005001000&quot;, &quot;postName&quot;: &quot;ç»“ç®—å‘˜&quot;, &quot;deptVo&quot;: { &quot;id&quot;: &quot;1671445634122588164&quot;, &quot;createTime&quot;: &quot;2023-06-22 11:42:36&quot;, &quot;updateTime&quot;: &quot;2023-06-30 09:14:16&quot;, &quot;createBy&quot;: &quot;1671362878457892866&quot;, &quot;updateBy&quot;: &quot;1&quot;, &quot;dataState&quot;: &quot;0&quot;, &quot;remark&quot;: &quot;å•Šå®æ‰“å®æ‰“é˜¿è¨å¾·é˜¿è¨å¾·æŒ‰æ—¶&quot;, &quot;parentDeptNo&quot;: &quot;100001000000000&quot;, &quot;deptNo&quot;: &quot;100001005000000&quot;, &quot;deptName&quot;: &quot;è´¢åŠ¡éƒ¨&quot;, &quot;sortNo&quot;: 2, &quot;leaderId&quot;: &quot;1671403256519077890&quot;, &quot;level&quot;: 4 } } ] }, &quot;operationTime&quot;: &quot;2023-08-27 02:53:24&quot;} æ€è·¯: åˆ†é¡µhelperä¼ å…¥åˆ†é¡µæ•°å’Œåˆ†é¡µå¤§å° æ£€æŸ¥å½“å‰ä¼ è¿›æ¥çš„å²—ä½dtoä¸èƒ½ä¸ºç©º è°ƒç”¨å²—ä½æŸ¥è¯¢çš„æ¡ä»¶æŸ¥è¯¢çš„mapperæŸ¥è¯¢åˆ°å½“å‰éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å²—ä½äºº è°ƒç”¨ç°æˆçš„æ–¹æ³•æŠŠä¸Šé¢å¾—åˆ°çš„æ‰€æœ‰å²—ä½äººæ”¾è¿›å»å¾—åˆ°äº†å“åº”å‚æ•°é‡Œé¢æ ¼å¼çš„æ•°æ® å¦‚æœå½“å‰å“åº”æ ¼å¼é‡Œé¢çš„Recordsä¸ºä¸ä¸ºç©ºçš„è¯ éå†æ¯ä¸€ä¸ªé‡Œé¢çš„Recordsé‡Œå¹¶ä¸”æŠŠé‡Œé¢çš„æ¯ä¸€ä¸ªéƒ¨é—¨å·å°è£…æˆä¸€ä¸ªéƒ¨é—¨å·åˆ—è¡¨ æŠŠå½“å‰æ•´ä¸ªå“åº”é‡Œé¢çš„æ¯ä¸€ä¸ªRecordséå†ä¸€ä¸‹ï¼Œå¾€æ¯ä¸ªé‡Œé¢æ ¼å¼åŒ–ä¸€ä¸‹åˆ›å»ºæ—¶é—´ å†æ¬¡éå†æ‰€æœ‰çš„Recordsæ‹¿åˆ°æ¯ä¸€ä¸ªéƒ¨é—¨ï¼Œæ‹¿åˆ°å½“å‰æ—¶é—´å¾€é‡Œé¢æ ¼å¼åŒ–æ—¶é—´ éå†æ‹¿åˆ°çš„éƒ¨é—¨åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªéƒ¨é—¨å’Œå²—ä½ä¸­ä¿å­˜çš„éƒ¨é—¨id è¿›è¡Œå¯¹æ¯”ã€‚ ä»£ç å®ç°12345678910111213141516171819/*** * å¤šæ¡ä»¶æŸ¥è¯¢å²—ä½åˆ†é¡µåˆ—è¡¨ * @param postDto å²—ä½VoæŸ¥è¯¢æ¡ä»¶ * @param pageNum é¡µç  * @param pageSize æ¯é¡µæ¡æ•° * @return: PageResponse&lt;PostVo&gt; */ @PostMapping(&quot;page/{pageNum}/{pageSize}&quot;) @ApiOperation(value = &quot;å²—ä½åˆ†é¡µ&quot;,notes = &quot;å²—ä½åˆ†é¡µ&quot;) @ApiImplicitParams({ @ApiImplicitParam(name = &quot;postDto&quot;,value = &quot;å²—ä½DTOå¯¹è±¡&quot;,required = true,dataType = &quot;PostDto&quot;), @ApiImplicitParam(paramType = &quot;path&quot;,name = &quot;pageNum&quot;,value = &quot;é¡µç &quot;,example = &quot;1&quot;,dataType = &quot;Integer&quot;), @ApiImplicitParam(paramType = &quot;path&quot;,name = &quot;pageSize&quot;,value = &quot;æ¯é¡µæ¡æ•°&quot;,example = &quot;10&quot;,dataType = &quot;Integer&quot;) }) public ResponseResult&lt;PageResponse&lt;PostVo&gt;&gt; findPostVoResponse(@RequestBody PostDto postDto,@PathVariable(&quot;pageNum&quot;) int pageNum,@PathVariable(&quot;pageSize&quot;) int pageSize){ PageResponse&lt;PostVo&gt; pageResponse = postService.findPostPage(postDto,pageNum,pageSize); return ResponseResult.success(pageResponse); } 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * å¤šæ¡ä»¶æŸ¥è¯¢å²—ä½è¡¨åˆ†é¡µåˆ—è¡¨ * @param postDto æŸ¥è¯¢æ¡ä»¶ * @param pageNum é¡µç  * @param pageSize æ¯é¡µæ¡æ•° * @return Page&lt;PostVo&gt; */ @Override public PageResponse&lt;PostVo&gt; findPostPage(PostDto postDto, int pageNum, int pageSize) { PageHelper.startPage(pageNum, pageSize); //æ£€æŸ¥ä¸€ä¸‹ä¼ è¿›æ¥çš„dtoæ˜¯å¦ä¸ºç©º if (EmptyUtil.isNullOrEmpty(postDto)){ throw new BaseException(&quot;éƒ¨é—¨ä¸èƒ½ä¸ºç©º&quot;); } //å…ˆè¿›è¡Œå²—ä½æŸ¥è¯¢,æ‹¿åˆ°äº†æ‰€æœ‰çš„å²—ä½äºº Page&lt;List&lt;Post&gt;&gt; page = postMapper.selectPage(postDto); //è¿™é‡Œæ‹¿åˆ°äº†æ‰€æœ‰çš„å“åº”æ•°æ® PageResponse&lt;PostVo&gt; pageResponse = PageResponse.of(page, PostVo.class); //æ£€æŸ¥å½“å‰å“åº”æ•°æ®å¦‚æœä¸ä¸ºç©ºçš„è¯ if (!EmptyUtil.isNullOrEmpty(pageResponse.getRecords())){ List&lt;String&gt; deptNos = pageResponse.getRecords().stream().map(postVo -&gt; postVo.getDeptNo()).collect(Collectors.toList()); //æ ¹æ®æ‹¿åˆ°çš„éƒ¨é—¨å·å»æ‹¿åˆ°æ‰€æœ‰çš„éƒ¨é—¨ List&lt;Dept&gt; deptVoList = deptMapper.findDeptInDeptNos(deptNos); //éå†é‡Œé¢çš„æ¯ä¸€ä¸ª pageResponse.getRecords().forEach(n -&gt;{ n.setCreateDay(LocalDateTimeUtil.format(n.getCreateTime(), &quot;yyyy-MM-dd&quot;)); deptVoList.forEach( d -&gt; { //å¯¹æ¯”å²—ä½é‡Œé¢çš„ä¿å­˜çš„é‚£ä¸ªéƒ¨é—¨ï¼Œå¤–é¢çš„é‚£ä¸ªæ˜¯ä¸æ˜¯ä¸€æ · if (n.getDeptNo().equals(d.getDeptNo())){ n.setDeptVo(BeanConv.toBean(d,DeptVo.class)); } }); }); } return pageResponse; } ä¿®æ”¹å²—ä½å…¶ä¸­çš„â€ç¼–è¾‘â€ã€â€å¯ç”¨â€ã€â€ç¦ç”¨â€ ä¸‰ä¸ªæŒ‰é’®å…±ç”¨è¿™ä¸ªæ¥å£ æ¥å£åœ°å€:/post è¯·æ±‚æ–¹å¼:PATCH è¯·æ±‚ç¤ºä¾‹: 1234567{ &quot;id&quot;: 0, //ä¸»é”® &quot;deptNo&quot;: &quot;&quot;, //éƒ¨é—¨ç¼–å· &quot;remark&quot;: &quot;&quot;, //å¤‡æ³¨ &quot;dataState&quot;: &quot;&quot;,//æ˜¯å¦å¯ç”¨(0:å¯ç”¨,1:ç¦ç”¨) &quot;postName&quot;: &quot;&quot; //å²—ä½åç§°} å“åº”ç¤ºä¾‹: 123456{ &quot;code&quot;: 0, &quot;data&quot;: true, &quot;msg&quot;: &quot;&quot;, &quot;operationTime&quot;: &quot;&quot;} å…ˆè½¬æˆæ ‡å‡†çš„å¯¹è±¡ åˆ¤æ–­ å¦‚æœçŠ¶æ€æ˜¯ç¦ç”¨ ç”³è¯·ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²ï¼Œä¸€ä¼šç”¨æ¥å­˜æ”¾å²—ä½ç¼–ç  æ ¹æ®ä¼ è¿›æ¥çš„æ‹¿åˆ°å¯¹åº”çš„å²—ä½ç ,å­˜æ”¾åˆ°å­—ç¬¦ä¸²ä¸­ æ£€æŸ¥å¯¹åº”å²—ä½ä¸‹çš„å‘˜å·¥æ•°ç›® åˆ¤æ–­å¦‚æœè¯¥å²—ä½ä¸‹æœ‰å‘˜å·¥åˆ™æŠ¥é”™ æœ€åè°ƒç”¨æ›´æ–°çš„mapperæ¥æ›´æ–° å¦‚æœä¿®æ”¹çš„æ•°ç›®ä¸º0 æŠ¥é”™ ä»£ç å®ç°12345678910111213141516/** * ä¿®æ”¹å²—ä½ * @param postDto å²—ä½DTOå¯¹è±¡ * @return Boolean æ˜¯å¦ä¿®æ”¹æˆåŠŸ */ @PatchMapping @ApiOperation(value = &quot;å²—ä½ä¿®æ”¹&quot;,notes = &quot;å²—ä½ä¿®æ”¹&quot;) @ApiImplicitParam(name = &quot;postDto&quot;,value = &quot;å²—ä½DTOå¯¹è±¡&quot;,required = true,dataType = &quot;PostDto&quot;) @ApiOperationSupport(includeParameters = {&quot;postDto.deptNo&quot;,&quot;postDto.dataState&quot;,&quot;postDto.postName&quot;, &quot;postDto.remark&quot;, &quot;postDto.id&quot;}) public ResponseResult&lt;Boolean&gt; updatePost(@RequestBody PostDto postDto){ Boolean flag = postService.updatePost(postDto); return ResponseResult.success(flag); } 1234567891011121314151617181920212223242526272829/** * ä¿®æ”¹å²—ä½è¡¨ * @param postDto å¯¹è±¡ä¿¡æ¯ * @return Boolean */ @Override public Boolean updatePost(PostDto postDto){ Post post = BeanUtil.toBean(postDto, Post.class); //åˆ¤æ–­ä¸€ä¸‹çŠ¶æ€æ˜¯å¦ä¸ºç¦ç”¨ if (post.getDataState().equals(&quot;1&quot;)){ //è¿›æ¥è¯´æ˜çŠ¶æ€æ˜¯ç¦ç”¨çš„ //ç”³è¯·ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸² String[] s= {&quot;&quot;}; //æ‹¿åˆ°å¯¹åº”çš„å²—ä½ s[0] = post.getPostNo(); //æŸ¥çœ‹å½“å‰å²—ä½ä¸‹æœ‰æ²¡æœ‰å‘˜å·¥ Integer total = checkPostHasUser(s); if (total &gt; 0){ //è¯´æ˜æœ‰å‘˜å·¥ throw new RuntimeException(&quot;å²—ä½å·²åˆ†é…,ä¸èƒ½ç¦ç”¨&quot;); } } int flag = postMapper.updateByPrimaryKey(post); if (flag == 0){//è¯´æ˜å¤±è´¥äº† throw new RuntimeException(&quot;ä¿®æ”¹èŒä½ä¿¡æ¯å‡ºé”™&quot;); } return true; } ä¿å­˜å²—ä½æ¥å£åœ°å€:/post è¯·æ±‚æ–¹å¼:PUT è¯·æ±‚ç¤ºä¾‹: 123456{ &quot;deptNo&quot;: &quot;&quot;, //éƒ¨é—¨ç¼–å· &quot;remark&quot;: &quot;&quot;, //å¤‡æ³¨ &quot;dataState&quot;: &quot;&quot;,//æ˜¯å¦å¯ç”¨(0:å¯ç”¨,1:ç¦ç”¨) &quot;postName&quot;: &quot;&quot; //å²—ä½åç§°} å“åº”ç¤ºä¾‹: 123456{ &quot;code&quot;: 0, &quot;data&quot;: true, &quot;msg&quot;: &quot;&quot;, &quot;operationTime&quot;: &quot;&quot;} è½¬æˆæ­£å¸¸çš„å¯¹è±¡ æ ¹æ®ä¼ è¿›æ¥çš„ï¼Œè°ƒç”¨æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å²—ä½ç¼–å· å¾€ä¼ è¿›æ¥çš„é‡Œé¢è®¾ç½®è¿›å»å²—ä½å· è°ƒç”¨mapperæ¥è¿›è¡Œæ•°æ®åº“æ’å…¥æ“ä½œ åˆ¤æ–­æ’å…¥ç»“æœçš„è¿”å›æ•°å€¼ï¼Œå¦‚æœä¸º0ä»£è¡¨å¤±è´¥ è½¬æˆå‰ç«¯å‹å¥½çš„VOçŠ¶æ€ï¼Œä½œä¸ºä¸€ä¼šè¿”å›çš„æœ€ç»ˆå€¼ è£…å¤‡éƒ¨é—¨ï¼Œè£…é…æ•°æ®çš„çŠ¶æ€ä¸º0 ä½å¯ç”¨çŠ¶æ€ï¼Œä»ä¼ è¿›æ¥çš„å‚æ•°ä¸­æ‹¿åˆ°éƒ¨é—¨ç¼–å·ä½œä¸ºçˆ¶éƒ¨é—¨ç¼–å· æ ¹æ®ä¼ éƒ¨é—¨æ‰¾è¯¥éƒ¨é—¨ä¸‹çš„æ‰€æœ‰éƒ¨é—¨åˆ—è¡¨ å¦‚æœéƒ¨é—¨åˆ—è¡¨ä¸ä¸ºç©ºåˆ™é‚£éƒ¨é—¨åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºéƒ¨é—¨ï¼Œæ­¤å¤„éœ€è¦ä¸“ä¸ºå‰ç«¯ä¸“ç”¨çš„voï¼ŒæŠŠå®ƒè®¾ç½®åˆ°å‰é¢å°è£…çš„è¿”å›ç»“æœçº§ä¸­ï¼Œå¦‚æœä¸ºç©ºå°±ç›´æ¥ä¸‹ä¸€æ­¥è¿”å›äº†å•¥ï¼Œè¯´æ˜åœ°ä¸‹æ²¡æœ‰èŠ‚ç‚¹äº† ä»£ç å®ç°123456789101112131415161718192021222324@Override public PostVo createPost(PostDto postDto) { Post post = BeanUtil.toBean(postDto, Post.class); String postNo = createPostNo(post.getDeptNo()); //æŠŠå²—ä½è®¾ç½®ä¸Šå» post.setPostNo(postNo); int flag = postMapper.insert(post); if (flag == 0){ new RuntimeException(&quot;ä¿å­˜èŒä½ä¿¡æ¯å‡ºé”™&quot;); } PostVo postVoResult = BeanConv.toBean(post, PostVo.class); //è£…å¤‡éƒ¨é—¨,è¿™æ˜¯ä¸ºäº†ä¸‹ä¸€æ­¥çš„æŸ¥è¯¢åšå‡†å¤‡ DeptDto deptDto = DeptDto.builder().dataState(SuperConstant.DATA_STATE_0) .parentDeptNo(postDto.getDeptNo()).build(); List&lt;Dept&gt; deptList = deptMapper.selectList(deptDto);//æ‹¿åˆ°éƒ¨é—¨çš„list if (!EmptyUtil.isNullOrEmpty(deptList)){ postVoResult.setDeptVo(BeanConv.toBean(deptList.get(0),DeptVo.class)); } return postVoResult; }","link":"/2025/02/18/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","link":"/tags/Java/"}],"categories":[],"pages":[]}